<!-- omit in toc -->
# ワークセット

<!-- omit in toc -->
## ワークセット一覧

- [会員登録ページ](#会員登録ページ)
  - [登録バリデーション](#登録バリデーション)
  - [会員登録処理](#会員登録処理)
- [ログインページ](#ログインページ)
  - [ログインバリデーション](#ログインバリデーション)
  - [ログイン処理](#ログイン処理)
- [打刻ページ](#打刻ページ)
  - [打刻ページの初期化処理](#打刻ページの初期化処理)
  - [勤務開始処理](#勤務開始処理)
  - [勤務終了処理](#勤務終了処理)
  - [休憩開始処理](#休憩開始処理)
  - [休憩終了処理](#休憩終了処理)
- [日付別勤怠ページ](#日付別勤怠ページ)
  - [当日の日付別勤怠情報取得](#当日の日付別勤怠情報取得)
  - [前日の日付別勤怠情報取得](#前日の日付別勤怠情報取得)
  - [翌日の日付別勤怠情報取得](#翌日の日付別勤怠情報取得)
  - [前ページの日付別勤怠情報取得](#前ページの日付別勤怠情報取得)
  - [次ページの日付別勤怠情報取得](#次ページの日付別勤怠情報取得)

## 会員登録ページ

### 登録バリデーション

- 入力
  - 名前
  - メールアドレス
  - パスワード
- 処理
  1. 名前を検証する
     - 入力必須
     - 文字列
     - 最大191文字
  2. メールアドレスを検証する
     - 入力必須
     - メール形式
     - 重複不可
     - 文字列
     - 最大191文字
  3. パスワードを検証する
     - 入力必須
     - 8文字以上
     - 最大191文字
- 出力
  - バリデーション成功時
    - 検証済み名前
    - 検証済みメールアドレス
    - 検証済みパスワード
  - バリデーション失敗時
    - エラーメッセージ

### 会員登録処理

- 入力
  - 検証済み名前
  - 検証済みメールアドレス
  - 検証済みパスワード
- 処理
  1. パスワードをハッシュ化する
  2. 以下のデータをデータベースに保存する
     - 検証済み名前 → 会員名
     - 検証済みメールアドレス → 会員メールアドレス
     - ハッシュ化した検証済みパスワード → 会員パスワード
  3. セッションを再生成する
- 出力
  - 認証済みのセッション

## ログインページ

### ログインバリデーション

- 入力
  - メールアドレス
  - パスワード
- 処理
  1. メールアドレスを検証する
     - 入力必須
     - 文字列
     - 最大191文字
  2. パスワードを検証する
     - 入力必須
     - 最大191文字
- 出力
  - バリデーション成功時
    - 検証済みメールアドレス
    - 検証済みパスワード
  - バリデーション失敗時
    - エラーメッセージ

### ログイン処理

- 入力
  - 検証済みメールアドレス
  - 検証済みパスワード
- 処理
  1. 検証済みメールアドレスでデータベースから以下のデータを検索する
     - 会員メールアドレス
     - 会員パスワード
  2. 検証済みパスワードをハッシュ化する
  3. ハッシュ化した検証済みパスワードと会員パスワードを比較する
- 出力
  - ログイン成功時
    - 認証済みのセッション
  - ログイン失敗時
    - エラーメッセージ

## 打刻ページ

### 打刻ページの初期化処理

- 入力
  - 勤務開始日時
- 処理
  1. 以下の条件に当てはまる場合、`NULL` を打刻日時として勤務終了処理を行う
     - 勤務開始日時がデータベースに保存されている
     - 勤務開始日時の日付が前日以前である
  2. すべてのボタンを無効化する
  3. 勤務前である場合、勤務開始ボタンを有効化する
  4. 勤務中かつ非休憩である場合、勤務終了ボタンと休憩開始ボタンを有効化する
  5. 休憩中である場合、休憩終了ボタンを有効化する
- 出力

### 勤務開始処理

- 入力
  - 勤務時間
  - 勤務開始日時
- 処理
  1. 以下の条件に当てはまる場合のみ処理を行う
     - 勤務開始日時がデータベースに保存されていない
  2. 現在の年月日の勤務時間がデータベースに保存されている場合
     - 勤務時間開始日時を勤務開始日時とする
     - 現在の年月日の勤務時間をデータベースから削除する
  3. 現在の年月日の勤務時間がデータベースに保存されていない場合
     - 現在日時を勤務開始日時とする
  4. 勤務開始日時をデータベースに保存する
- 出力

### 勤務終了処理

- 入力
  - 勤務開始日時
  - 休憩開始日時
  - 打刻日時
- 処理
  1. 以下の条件に当てはまる場合のみ処理を行う
     - 勤務開始日時がデータベースに保存されている
     - 休憩開始日時がデータベースに保存されていない
  2. 打刻日時が指定されていない場合、現在日時を打刻日時とする
  3. 勤務開始日時をデータベースから削除する
  4. 勤務時間をデータベースに保存する
     - 勤務開始日時を勤務時間開始日時とする
     - 打刻日時を勤務時間終了日時とする
- 出力

### 休憩開始処理

- 入力
  - 勤務開始日時
  - 休憩開始日時
- 処理
  1. 以下の条件でのみ処理を行う
     - 勤務開始日時がデータベースに保存されている
     - 休憩開始日時がデータベースに保存されていない
  2. 現在日時を休憩開始日時としてデータベースに保存する
- 出力

### 休憩終了処理

- 入力
  - 休憩開始日時
- 処理
  1. 以下の条件でのみ処理を行う
     - 休憩開始日時がデータベースに保存されている
  2. 休憩開始日時をデータベースから削除する
  3. 休憩時間をデータベースに保存する
     - 休憩開始日時を休憩時間開始日時とする
     - 現在日時を休憩時間終了日時とする
- 出力

## 日付別勤怠ページ

### 当日の日付別勤怠情報取得

- 入力
  - 全会員の勤務時間
  - 全会員の休憩時間
  - 勤務時間と休憩時間に関連する会員名
- 処理
  1. 当日の日付を取得する
  2. 勤務時間と休憩時間の内、以下の条件に当てはまるものだけを表示の対象とする
     - タイムスタンプが当日
     - 先頭から5件
  3. 勤務時間開始日時を勤務開始時刻に変換する
  4. 勤務時間終了日時を勤務終了時刻に変換する
  5. 会員ごとに合計休憩時間を計算する
  6. 会員ごとに労働時間を計算する
- 出力
  - 当日の日付
  - 勤怠情報5件
    - 勤務時間と休憩時間に関連する会員名
    - 勤務開始時刻
    - 勤務終了時刻
    - 合計休憩時間
    - 労働時間

### 前日の日付別勤怠情報取得

- 入力
  - 日付
  - ページ番号
  - 全会員の勤務時間
  - 全会員の休憩時間
  - 勤務時間と休憩時間に関連する会員名
- 処理
  1. 入力日付の前日を計算する
  2. 勤務時間と休憩時間の内、以下の条件に当てはまるものだけを表示の対象とする
     - タイムスタンプが入力日付の前日
     - 5件で1ページとして「入力ページ番号」ページ目
  3. 勤務時間開始日時を勤務開始時刻に変換する
  4. 勤務時間終了日時を勤務終了時刻に変換する
  5. 会員ごとに合計休憩時間を計算する
  6. 会員ごとに労働時間を計算する
- 出力
  - 入力日付の前日
  - 勤怠情報5件
    - 勤務時間と休憩時間に関連する会員名
    - 勤務開始時刻
    - 勤務終了時刻
    - 合計休憩時間
    - 労働時間

### 翌日の日付別勤怠情報取得

- 入力
  - 日付
  - ページ番号
  - 全会員の勤務時間
  - 全会員の休憩時間
  - 勤務時間と休憩時間に関連する会員名
- 処理
  1. 入力日付の翌日を計算する
  2. 勤務時間と休憩時間の内、以下の条件に当てはまるものだけを表示の対象とする
     - タイムスタンプが入力日付の翌日
     - 5件で1ページとして「入力ページ番号」ページ目
  3. 勤務時間開始日時を勤務開始時刻に変換する
  4. 勤務時間終了日時を勤務終了時刻に変換する
  5. 会員ごとに合計休憩時間を計算する
  6. 会員ごとに労働時間を計算する
- 出力
  - 入力日付の翌日
  - 勤怠情報5件
    - 勤務時間と休憩時間に関連する会員名
    - 勤務開始時刻
    - 勤務終了時刻
    - 合計休憩時間
    - 労働時間

### 前ページの日付別勤怠情報取得

- 入力
  - 日付
  - ページ番号
  - 全会員の勤務時間
  - 全会員の休憩時間
  - 勤務時間と休憩時間に関連する会員名
- 処理
  1. `新しいページ番号 = 入力ページ番号 - 1` (1が最小値)
  2. 勤務時間と休憩時間の内、以下の条件に当てはまるものだけを表示の対象とする
     - タイムスタンプが入力日付
     - 5件で1ページとして「新しいページ番号」ページ目
  3. 勤務時間開始日時を勤務開始時刻に変換する
  4. 勤務時間終了日時を勤務終了時刻に変換する
  5. 会員ごとに合計休憩時間を計算する
  6. 会員ごとに労働時間を計算する
- 出力
  - 入力日付
  - 勤怠情報5件
    - 勤務時間と休憩時間に関連する会員名
    - 勤務開始時刻
    - 勤務終了時刻
    - 合計休憩時間
    - 労働時間

### 次ページの日付別勤怠情報取得

- 入力
  - 日付
  - ページ番号
  - 全会員の勤務時間
  - 全会員の休憩時間
  - 勤務時間と休憩時間に関連する会員名
- 処理
  1. `新しいページ番号 = 入力ページ番号 + 1` (1が最小値)
  2. 勤務時間と休憩時間の内、以下の条件に当てはまるものだけを表示の対象とする
     - タイムスタンプが入力日付
     - 5件で1ページとして「新しいページ番号」ページ目
  3. 勤務時間開始日時を勤務開始時刻に変換する
  4. 勤務時間終了日時を勤務終了時刻に変換する
  5. 会員ごとに合計休憩時間を計算する
  6. 会員ごとに労働時間を計算する
- 出力
  - 入力日付
  - 勤怠情報5件
    - 勤務時間と休憩時間に関連する会員名
    - 勤務開始時刻
    - 勤務終了時刻
    - 合計休憩時間
    - 労働時間
